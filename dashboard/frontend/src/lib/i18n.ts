import { create } from 'zustand'
import { persist } from 'zustand/middleware'

export type Lang = 'en' | 'ru'

interface I18nState {
  lang: Lang
  setLang: (lang: Lang) => void
  t: (key: string) => string
}

const translations: Record<Lang, Record<string, string>> = {
  en: {
    // Dashboard
    'dashboard.title': 'Security Dashboard',
    'dashboard.subtitle': 'Hardening & compliance overview',
    'dashboard.hosts': 'Hosts',
    'dashboard.online': 'Online',
    'dashboard.scans': 'Scans',
    'dashboard.avg_score': 'Avg Score',
    'dashboard.findings': 'Findings',
    'dashboard.findings_failed': 'failed',
    'dashboard.schedules': 'Schedules',
    'dashboard.schedules_active': 'active',
    'dashboard.score_trend': 'Score Trend',
    'dashboard.findings_by_severity': 'Findings by Severity',
    'dashboard.scanner_comparison': 'Scanner Comparison',
    'dashboard.scans_by_status': 'Scans by Status',
    'dashboard.host_score_dist': 'Host Score Distribution',
    'dashboard.host_compliance': 'Host Compliance',
    'dashboard.recent_scans': 'Recent Scans',
    'dashboard.top_failing': 'Top Failing Rules',
    'dashboard.upcoming_scans': 'Upcoming Scans',
    'dashboard.scan_activity': 'Scan Activity',
    'dashboard.no_scan_data': 'No scan data for selected period',
    'dashboard.no_findings': 'No findings data',
    'dashboard.no_scanner': 'No scanner data',
    'dashboard.no_status': 'No scan status data',
    'dashboard.no_score': 'No score data',
    'dashboard.no_hosts': 'No hosts configured',
    'dashboard.no_scans': 'No recent scans',
    'dashboard.no_rules': 'No failing rules detected',
    'dashboard.all_scanners': 'All scanners',
    'dashboard.no_upcoming': 'No upcoming scans scheduled',
    'dashboard.failed_load': 'Failed to load dashboard data',

    // Table headers
    'table.host': 'Host',
    'table.type': 'Type',
    'table.os': 'OS',
    'table.score': 'Score',
    'table.rule': 'Rule',
    'table.severity': 'Severity',
    'table.hits': 'Hits',
    'table.status': 'Status',
    'table.tags': 'Tags',
    'table.scanner': 'Scanner',
    'table.results': 'Results',
    'table.duration': 'Duration',
    'table.started': 'Started',
    'table.actions': 'Actions',

    // Periods
    'period.1h': '1 hour',
    'period.12h': '12 hours',
    'period.24h': '24 hours',
    'period.7d': '7 days',
    'period.14d': '14 days',
    'period.30d': '30 days',
    'period.90d': '90 days',

    // Navigation
    'nav.dashboard': 'Dashboard',
    'nav.hosts': 'Hosts',
    'nav.scans': 'Scans',
    'nav.schedules': 'Schedules',
    'nav.settings': 'Settings',
    'nav.users': 'Users',

    // Hosts page
    'hosts.title': 'Hosts',
    'hosts.subtitle': 'Manage scan targets',
    'hosts.sync_docker': 'Sync Docker',
    'hosts.add_host': 'Add Host',
    'hosts.no_hosts': 'No hosts configured. Add a host or sync from Docker.',

    // Scans page
    'scans.title': 'Scans',
    'scans.subtitle': 'Security scan history and results',
    'scans.new_scan': 'New Scan',
    'scans.no_scans': 'No scans yet. Start a new scan to see results.',
    'scans.date_from': 'From',
    'scans.date_to': 'To',

    // Schedules page
    'schedules.title': 'Schedules',
    'schedules.subtitle': 'Automated scan schedules',
    'schedules.add': 'Add Schedule',
    'schedules.no_schedules': 'No schedules configured.',

    // Users page
    'users.title': 'Users',
    'users.subtitle': 'Manage user accounts and roles',
    'users.create': 'Create User',
    'users.no_users': 'No users found',
    'users.email': 'Email',
    'users.role': 'Role',
    'users.created': 'Created',
    'users.pwd_change': 'pwd change required',
    'users.active': 'Active',
    'users.disabled': 'Disabled',
    'users.delete_confirm': 'Delete user',
    'users.admin_required': 'Admin privileges required to manage users.',
    'users.create_title': 'Create User',
    'users.username': 'Username',
    'users.full_name': 'Full Name',
    'users.password': 'Password',
    'users.role_admin': 'Admin - full access',
    'users.role_user': 'User - run scans, view results',
    'users.role_auditor': 'Auditor - read-only access',
    'users.pwd_hint': 'User will be required to change password on first login',
    'users.cancel': 'Cancel',

    // Hosts page - modal & details
    'hosts.add_title': 'Add Host',
    'hosts.name': 'Name',
    'hosts.type': 'Type',
    'hosts.type_container': 'Docker Container',
    'hosts.type_ssh': 'SSH Host',
    'hosts.type_local': 'Local',
    'hosts.address': 'Address',
    'hosts.ssh_user': 'SSH User',
    'hosts.check': 'Check',
    'hosts.delete_confirm': 'Delete this host?',
    'hosts.unknown_os': 'Unknown OS',
    'hosts.creating': 'Creating...',
    'hosts.create_btn': 'Create',

    // Scans page - details
    'scans.status': 'Status',
    'scans.host': 'Host',
    'scans.scanner': 'Scanner',
    'scans.score': 'Score',
    'scans.results': 'Results',
    'scans.duration': 'Duration',
    'scans.started': 'Started',
    'scans.actions': 'Actions',
    'scans.passed': 'passed',
    'scans.failed': 'failed',
    'scans.new_title': 'New Scan',
    'scans.select_host': 'Select host...',
    'scans.all_hosts': 'All hosts',
    'scans.starting': 'Starting...',
    'scans.start_btn': 'Start Scan',

    // Schedules page - details
    'schedules.name': 'Name',
    'schedules.host': 'Host',
    'schedules.scanner': 'Scanner',
    'schedules.cron': 'Cron Expression',
    'schedules.cron_hint': 'e.g., "0 2 * * *" = daily at 2 AM',
    'schedules.runs': 'Runs',
    'schedules.next': 'Next',
    'schedules.delete_confirm': 'Delete schedule?',
    'schedules.add_title': 'Add Schedule',
    'schedules.all_hosts': 'All hosts',
    'schedules.all_scanners': 'All scanners',
    'schedules.frequency': 'Frequency',
    'schedules.freq_daily': 'Daily',
    'schedules.freq_weekly': 'Weekly',
    'schedules.freq_monthly': 'Monthly',
    'schedules.freq_yearly': 'Yearly',
    'schedules.time': 'Time',
    'schedules.days_of_week': 'Days of week',
    'schedules.day_of_month': 'Day of month',
    'schedules.month': 'Month',
    'schedules.mon': 'Mon',
    'schedules.tue': 'Tue',
    'schedules.wed': 'Wed',
    'schedules.thu': 'Thu',
    'schedules.fri': 'Fri',
    'schedules.sat': 'Sat',
    'schedules.sun': 'Sun',

    // Settings page
    'settings.title': 'Settings',
    'settings.subtitle': 'Manage your account',
    'settings.profile': 'Profile',
    'settings.username': 'Username',
    'settings.email': 'Email',
    'settings.role': 'Role',
    'settings.status': 'Status',
    'settings.active': 'Active',
    'settings.inactive': 'Inactive',
    'settings.security': 'Security',
    'settings.change_password': 'Change Password',
    'settings.last_pwd_change': 'Last password change',
    'settings.never': 'Never',
    'settings.notifications': 'Notifications',
    'settings.notif_completion': 'Email notifications for scan completion',
    'settings.notif_failures': 'Email notifications for scan failures',
    'settings.notif_digest': 'Weekly security digest',
    'settings.notif_email': 'Notification email',
    'settings.notif_email_placeholder': 'user@example.com',
    'settings.notif_save': 'Save',
    'settings.notif_test': 'Send test',
    'settings.notif_saved': 'Email saved',
    'settings.notif_sent': 'Test email sent',
    'settings.notif_not_configured': 'SMTP not configured',
    'settings.system': 'System',
    'settings.version': 'Version',
    'settings.api_endpoint': 'API Endpoint',
    'settings.change_email': 'Change',
    'settings.email_placeholder': 'New email address',
    'settings.email_save': 'Save',
    'settings.email_saved': 'Email updated successfully',
    'settings.email_error': 'Failed to update email',
    'settings.current_password': 'Current Password',
    'settings.new_password': 'New Password',
    'settings.confirm_password': 'Confirm Password',
    'settings.pwd_changed': 'Password changed successfully',
    'settings.pwd_error': 'Failed to change password',
    'settings.pwd_mismatch': 'Passwords do not match',
    'settings.pwd_short': 'Password must be at least 8 characters',
    'settings.saving': 'Saving...',

    // Auth
    'auth.title': 'Test-Hard Dashboard',
    'auth.subtitle': 'Security Hardening & Monitoring Platform',
    'auth.username': 'Username',
    'auth.password': 'Password',
    'auth.sign_in': 'Sign in',
    'auth.signing_in': 'Signing in...',
    'auth.change_password': 'Change Password',
    'auth.change_pwd_desc': 'You must change your password before continuing',
    'auth.new_password': 'New Password',
    'auth.confirm_password': 'Confirm Password',
    'auth.change_continue': 'Change Password & Continue',
    'auth.changing': 'Changing...',
    'auth.pwd_mismatch': 'Passwords do not match',
    'auth.pwd_short': 'Password must be at least 8 characters',
    'auth.invalid_creds': 'Invalid credentials',
    'auth.change_failed': 'Failed to change password',

    // Common
    'common.loading': 'Loading...',
    'common.in_progress': 'In progress',
    'common.logout': 'Logout',
    'common.cancel': 'Cancel',
    'common.clear': 'Clear',
    'common.save': 'Save',
    'common.create': 'Create',
    'common.delete': 'Delete',
  },
  ru: {
    // Dashboard
    'dashboard.title': 'Security Dashboard',
    'dashboard.subtitle': 'Обзор безопасности и соответствия',
    'dashboard.hosts': 'Хосты',
    'dashboard.online': 'Онлайн',
    'dashboard.scans': 'Сканирования',
    'dashboard.avg_score': 'Ср. оценка',
    'dashboard.findings': 'Проблемы',
    'dashboard.findings_failed': 'не пройдено',
    'dashboard.schedules': 'Расписания',
    'dashboard.schedules_active': 'активно',
    'dashboard.score_trend': 'Тренд оценок',
    'dashboard.findings_by_severity': 'Проблемы по критичности',
    'dashboard.scanner_comparison': 'Сравнение сканеров',
    'dashboard.scans_by_status': 'Сканирования по статусу',
    'dashboard.host_score_dist': 'Распределение оценок',
    'dashboard.host_compliance': 'Соответствие хостов',
    'dashboard.recent_scans': 'Последние сканирования',
    'dashboard.top_failing': 'Частые нарушения',
    'dashboard.upcoming_scans': 'Запланированные сканирования',
    'dashboard.scan_activity': 'Активность сканирований',
    'dashboard.no_scan_data': 'Нет данных за выбранный период',
    'dashboard.no_findings': 'Нет данных о проблемах',
    'dashboard.no_scanner': 'Нет данных сканеров',
    'dashboard.no_status': 'Нет данных о статусах',
    'dashboard.no_score': 'Нет данных об оценках',
    'dashboard.no_hosts': 'Хосты не настроены',
    'dashboard.no_scans': 'Нет последних сканирований',
    'dashboard.no_rules': 'Нарушений не обнаружено',
    'dashboard.all_scanners': 'Все сканеры',
    'dashboard.no_upcoming': 'Нет запланированных сканирований',
    'dashboard.failed_load': 'Не удалось загрузить данные',

    // Table headers
    'table.host': 'Хост',
    'table.type': 'Тип',
    'table.os': 'ОС',
    'table.score': 'Оценка',
    'table.rule': 'Правило',
    'table.severity': 'Критичность',
    'table.hits': 'Кол-во',
    'table.status': 'Статус',
    'table.tags': 'Теги',
    'table.scanner': 'Сканер',
    'table.results': 'Результаты',
    'table.duration': 'Длительность',
    'table.started': 'Запущено',
    'table.actions': 'Действия',

    // Periods
    'period.1h': '1 час',
    'period.12h': '12 часов',
    'period.24h': '24 часа',
    'period.7d': '7 дней',
    'period.14d': '14 дней',
    'period.30d': '30 дней',
    'period.90d': '90 дней',

    // Navigation
    'nav.dashboard': 'Дашборд',
    'nav.hosts': 'Хосты',
    'nav.scans': 'Сканирования',
    'nav.schedules': 'Расписания',
    'nav.settings': 'Настройки',
    'nav.users': 'Пользователи',

    // Hosts page
    'hosts.title': 'Хосты',
    'hosts.subtitle': 'Управление целями сканирования',
    'hosts.sync_docker': 'Синхронизация Docker',
    'hosts.add_host': 'Добавить хост',
    'hosts.no_hosts': 'Хосты не настроены. Добавьте хост или синхронизируйте из Docker.',

    // Scans page
    'scans.title': 'Сканирования',
    'scans.subtitle': 'История и результаты сканирований',
    'scans.new_scan': 'Новое сканирование',
    'scans.no_scans': 'Нет сканирований. Запустите новое сканирование.',
    'scans.date_from': 'С',
    'scans.date_to': 'По',

    // Schedules page
    'schedules.title': 'Расписания',
    'schedules.subtitle': 'Автоматизированные расписания сканирований',
    'schedules.add': 'Добавить расписание',
    'schedules.no_schedules': 'Расписания не настроены.',

    // Users page
    'users.title': 'Пользователи',
    'users.subtitle': 'Управление учетными записями и ролями',
    'users.create': 'Создать пользователя',
    'users.no_users': 'Пользователи не найдены',
    'users.email': 'Email',
    'users.role': 'Роль',
    'users.created': 'Создан',
    'users.pwd_change': 'требуется смена пароля',
    'users.active': 'Активен',
    'users.disabled': 'Отключен',
    'users.delete_confirm': 'Удалить пользователя',
    'users.admin_required': 'Требуются права администратора.',
    'users.create_title': 'Создание пользователя',
    'users.username': 'Имя пользователя',
    'users.full_name': 'Полное имя',
    'users.password': 'Пароль',
    'users.role_admin': 'Админ - полный доступ',
    'users.role_user': 'Пользователь - запуск сканирований',
    'users.role_auditor': 'Аудитор - только чтение',
    'users.pwd_hint': 'При первом входе пользователь должен сменить пароль',
    'users.cancel': 'Отмена',

    // Hosts page - modal & details
    'hosts.add_title': 'Добавить хост',
    'hosts.name': 'Имя',
    'hosts.type': 'Тип',
    'hosts.type_container': 'Docker-контейнер',
    'hosts.type_ssh': 'SSH-хост',
    'hosts.type_local': 'Локальный',
    'hosts.address': 'Адрес',
    'hosts.ssh_user': 'SSH пользователь',
    'hosts.check': 'Проверить',
    'hosts.delete_confirm': 'Удалить этот хост?',
    'hosts.unknown_os': 'Неизвестная ОС',
    'hosts.creating': 'Создание...',
    'hosts.create_btn': 'Создать',

    // Scans page - details
    'scans.status': 'Статус',
    'scans.host': 'Хост',
    'scans.scanner': 'Сканер',
    'scans.score': 'Оценка',
    'scans.results': 'Результаты',
    'scans.duration': 'Длительность',
    'scans.started': 'Запущено',
    'scans.actions': 'Действия',
    'scans.passed': 'пройдено',
    'scans.failed': 'не пройдено',
    'scans.new_title': 'Новое сканирование',
    'scans.select_host': 'Выберите хост...',
    'scans.all_hosts': 'Все хосты',
    'scans.starting': 'Запуск...',
    'scans.start_btn': 'Запустить',

    // Schedules page - details
    'schedules.name': 'Название',
    'schedules.host': 'Хост',
    'schedules.scanner': 'Сканер',
    'schedules.cron': 'Cron-выражение',
    'schedules.cron_hint': 'напр., "0 2 * * *" = ежедневно в 2:00',
    'schedules.runs': 'Запусков',
    'schedules.next': 'Следующий',
    'schedules.delete_confirm': 'Удалить расписание?',
    'schedules.add_title': 'Добавить расписание',
    'schedules.all_hosts': 'Все хосты',
    'schedules.all_scanners': 'Все сканеры',
    'schedules.frequency': 'Частота',
    'schedules.freq_daily': 'Ежедневно',
    'schedules.freq_weekly': 'Раз в неделю',
    'schedules.freq_monthly': 'Раз в месяц',
    'schedules.freq_yearly': 'Раз в год',
    'schedules.time': 'Время',
    'schedules.days_of_week': 'Дни недели',
    'schedules.day_of_month': 'День месяца',
    'schedules.month': 'Месяц',
    'schedules.mon': 'Пн',
    'schedules.tue': 'Вт',
    'schedules.wed': 'Ср',
    'schedules.thu': 'Чт',
    'schedules.fri': 'Пт',
    'schedules.sat': 'Сб',
    'schedules.sun': 'Вс',

    // Settings page
    'settings.title': 'Настройки',
    'settings.subtitle': 'Управление аккаунтом',
    'settings.profile': 'Профиль',
    'settings.username': 'Имя пользователя',
    'settings.email': 'Email',
    'settings.role': 'Роль',
    'settings.status': 'Статус',
    'settings.active': 'Активен',
    'settings.inactive': 'Неактивен',
    'settings.security': 'Безопасность',
    'settings.change_password': 'Сменить пароль',
    'settings.last_pwd_change': 'Последняя смена пароля',
    'settings.never': 'Никогда',
    'settings.notifications': 'Уведомления',
    'settings.notif_completion': 'Email-уведомления о завершении сканирования',
    'settings.notif_failures': 'Email-уведомления об ошибках сканирования',
    'settings.notif_digest': 'Еженедельный дайджест безопасности',
    'settings.notif_email': 'Email для уведомлений',
    'settings.notif_email_placeholder': 'user@example.com',
    'settings.notif_save': 'Сохранить',
    'settings.notif_test': 'Тест',
    'settings.notif_saved': 'Email сохранен',
    'settings.notif_sent': 'Тестовое письмо отправлено',
    'settings.notif_not_configured': 'SMTP не настроен',
    'settings.system': 'Система',
    'settings.version': 'Версия',
    'settings.api_endpoint': 'API Endpoint',
    'settings.change_email': 'Изменить',
    'settings.email_placeholder': 'Новый адрес email',
    'settings.email_save': 'Сохранить',
    'settings.email_saved': 'Email успешно обновлен',
    'settings.email_error': 'Не удалось обновить email',
    'settings.current_password': 'Текущий пароль',
    'settings.new_password': 'Новый пароль',
    'settings.confirm_password': 'Подтвердите пароль',
    'settings.pwd_changed': 'Пароль успешно изменен',
    'settings.pwd_error': 'Не удалось сменить пароль',
    'settings.pwd_mismatch': 'Пароли не совпадают',
    'settings.pwd_short': 'Пароль должен быть не менее 8 символов',
    'settings.saving': 'Сохранение...',

    // Auth
    'auth.title': 'Test-Hard Dashboard',
    'auth.subtitle': 'Платформа мониторинга безопасности',
    'auth.username': 'Имя пользователя',
    'auth.password': 'Пароль',
    'auth.sign_in': 'Войти',
    'auth.signing_in': 'Вход...',
    'auth.change_password': 'Смена пароля',
    'auth.change_pwd_desc': 'Необходимо сменить пароль перед продолжением',
    'auth.new_password': 'Новый пароль',
    'auth.confirm_password': 'Подтвердите пароль',
    'auth.change_continue': 'Сменить пароль и продолжить',
    'auth.changing': 'Смена...',
    'auth.pwd_mismatch': 'Пароли не совпадают',
    'auth.pwd_short': 'Пароль должен быть не менее 8 символов',
    'auth.invalid_creds': 'Неверные учетные данные',
    'auth.change_failed': 'Не удалось сменить пароль',

    // Common
    'common.loading': 'Загрузка...',
    'common.in_progress': 'Выполняется',
    'common.logout': 'Выход',
    'common.cancel': 'Отмена',
    'common.clear': 'Очистить',
    'common.save': 'Сохранить',
    'common.create': 'Создать',
    'common.delete': 'Удалить',
  },
}

export const useI18n = create<I18nState>()(
  persist(
    (set, get) => ({
      lang: 'ru' as Lang,
      setLang: (lang: Lang) => set({ lang }),
      t: (key: string) => {
        const { lang } = get()
        return translations[lang][key] || translations.en[key] || key
      },
    }),
    {
      name: 'i18n-storage',
      partialize: (state) => ({ lang: state.lang }),
    }
  )
)
