name: Dependency Updates

on:
  schedule:
    # Run weekly on Monday at 9:00 AM UTC
    - cron: '0 9 * * 1'
  workflow_dispatch:

jobs:
  update-dependencies:
    name: Check for Dependency Updates
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check for Docker image updates
        run: |
          echo "Checking for Docker image updates..."
          docker compose pull || true
          docker images --format "table {{.Repository}}:{{.Tag}}\t{{.Size}}\t{{.CreatedAt}}"

      - name: Check Python dependencies
        run: |
          pip install pip-audit
          pip-audit -r requirements.txt || true

      - name: Create update report
        run: |
          echo "# Dependency Update Report" > update-report.md
          echo "" >> update-report.md
          echo "Generated on: $(date)" >> update-report.md
          echo "" >> update-report.md
          echo "## Docker Images" >> update-report.md
          docker compose config --images >> update-report.md

      - name: Upload report
        uses: actions/upload-artifact@v3
        with:
          name: dependency-report
          path: update-report.md
