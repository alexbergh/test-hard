# Alertmanager Configuration
# SECURITY: Configure proper authentication before production use

route:
  receiver: 'default'
  group_by: ['alertname', 'severity']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 12h
  routes:
    # Route critical alerts immediately
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 10s
      repeat_interval: 1h

receivers:
  - name: 'default'
    webhook_configs:
      # SECURITY: Use HTTPS and authentication in production
      # Replace with your actual webhook endpoint
      # NOTE: Alertmanager doesn't support shell-style env var substitution.
      # For production, use envsubst or a config management tool.
      - url: 'http://localhost:5001/alerts'
        send_resolved: true
        # SECURITY: HTTP Basic Auth - configure in production
        http_config:
          basic_auth:
            username: 'alertmanager'
            password: 'CHANGE_ME_WEBHOOK_SECRET'
          # SECURITY: TLS configuration for HTTPS endpoints
          # tls_config:
          #   ca_file: /etc/alertmanager/certs/ca.crt
          #   cert_file: /etc/alertmanager/certs/client.crt
          #   key_file: /etc/alertmanager/certs/client.key
          #   insecure_skip_verify: false
        # Timeout for webhook requests
        timeout: 10s
        # Maximum number of alerts per webhook request
        max_alerts: 100

  - name: 'critical-alerts'
    webhook_configs:
      - url: 'http://localhost:5001/critical'
        send_resolved: true
        http_config:
          basic_auth:
            username: 'alertmanager'
            password: 'CHANGE_ME_WEBHOOK_SECRET'
          # Bearer token alternative (uncomment to use instead of basic_auth):
          # authorization:
          #   type: Bearer
          #   credentials: '${ALERTMANAGER_BEARER_TOKEN}'

# SECURITY NOTES:
# 1. Always use HTTPS in production - configure tls_config above
# 2. Set webhook credentials via environment variables:
#    - ALERTMANAGER_WEBHOOK_URL
#    - ALERTMANAGER_WEBHOOK_USER
#    - ALERTMANAGER_WEBHOOK_PASSWORD
# 3. Consider using mutual TLS for internal services
# 4. Rotate credentials regularly (recommended: every 90 days)
# 5. Use HashiCorp Vault or similar for secrets management
