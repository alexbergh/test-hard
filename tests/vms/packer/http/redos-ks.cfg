#version=RHEL7
install
text
lang ru_RU.UTF-8
keyboard ru
network --bootproto=dhcp --device=eth0 --activate
rootpw --iscrypted $6$randomsalt$9FJt4examplehashedpassword
firewall --enabled --service=ssh
auth --enableshadow --passalgo=sha512
timezone --utc Europe/Moscow
selinux --enforcing
bootloader --location=mbr --append="audit=1"
zerombr
clearpart --all --initlabel
autopart --type=lvm
services --enabled=sshd,auditd
user --name=secops --plaintext --password=ChangeMe!
reboot

%packages
@^minimal
chrony
vim-enhanced
policycoreutils-python
-aic94xx-firmware
-ivtv-firmware
%end

%post --log=/root/ks-post.log
useradd -m -G wheel secops || true
echo 'secops:ChangeMe!' | chpasswd
mkdir -p /home/secops/.ssh
chmod 700 /home/secops/.ssh
echo 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDemoKey secops@packer' > /home/secops/.ssh/authorized_keys
chmod 600 /home/secops/.ssh/authorized_keys
chown -R secops:secops /home/secops/.ssh
echo 'AllowUsers secops' >> /etc/ssh/sshd_config
systemctl enable auditd
%end
