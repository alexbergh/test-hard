#version=RHEL8
install
text
lang ru_RU.UTF-8
keyboard ru
network --bootproto=dhcp --activate
authselect --enablefeature=with-faillock --enablefeature=with-sudo
rootpw --iscrypted $6$randomsalt$9FJt4examplehashedpassword
firewall --enabled --service=ssh
timezone --utc Europe/Moscow
selinux --enforcing
bootloader --location=mbr --append="audit=1"
zerombr
clearpart --all --initlabel
autopart --type=lvm
user --name=secops --plaintext --password=ChangeMe!
services --enabled=sshd,auditd,chronyd
reboot

%packages
@^minimal-environment
chrony
podman
setools-console
-aic94xx-firmware
-ivtv-firmware
%end

%post --log=/root/ks-post.log
useradd -m -G wheel secops || true
echo 'secops:ChangeMe!' | chpasswd
mkdir -p /home/secops/.ssh
chmod 700 /home/secops/.ssh
echo 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDemoKey secops@packer' > /home/secops/.ssh/authorized_keys
chmod 600 /home/secops/.ssh/authorized_keys
chown -R secops:secops /home/secops/.ssh
systemctl enable auditd chronyd
%end
