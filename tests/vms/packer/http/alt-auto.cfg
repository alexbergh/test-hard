# Автоматическая установка ALT Server 8
lang ru_RU.UTF-8
keyboard ru
timezone Europe/Moscow
install
reboot

network --bootproto=dhcp --device=eth0 --hostname=alt-hardening

user --name=secops --password=ChangeMe! --groups=wheel
rootpw ChangeMe!

part /boot --fstype ext4 --size=1024
part pv.01 --size=1 --grow
volgroup vg_root pv.01
logvol swap --vgname=vg_root --size=2048 --name=swap
logvol / --vgname=vg_root --size=20480 --name=root --fstype=ext4

services --enabled=sshd,auditd
firewall --enabled --service=ssh

%packages
@core
openssh-server
audit
sudo
python3
%end

%post
/usr/sbin/usermod -aG wheel secops || true
echo 'secops ALL=(ALL) NOPASSWD:ALL' >/etc/sudoers.d/secops
chmod 440 /etc/sudoers.d/secops
sed -i 's/^#PermitRootLogin.*/PermitRootLogin no/' /etc/ssh/sshd_config
sed -i 's/^PasswordAuthentication.*/PasswordAuthentication no/' /etc/ssh/sshd_config
systemctl enable auditd
%end
