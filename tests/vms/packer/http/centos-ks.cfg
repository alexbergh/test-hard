#version=RHEL7
install
text
lang en_US.UTF-8
keyboard us
network --bootproto=dhcp --device=eth0 --activate
rootpw --iscrypted $6$randomsalt$9FJt4examplehashedpassword
firewall --enabled --service=ssh
auth --enableshadow --passalgo=sha512
timezone --utc Europe/Moscow
selinux --enforcing
bootloader --location=mbr --append="audit=1"
zerombr
clearpart --all --initlabel
autopart --type=lvm
user --name=secops --plaintext --password=ChangeMe!
services --enabled=sshd,auditd,rsyslog
reboot

%packages
@^minimal
chrony
aide
openscap-scanner
%end

%post --log=/root/ks-post.log
useradd -m -G wheel secops || true
echo 'secops:ChangeMe!' | chpasswd
mkdir -p /home/secops/.ssh
chmod 700 /home/secops/.ssh
echo 'ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDemoKey secops@packer' > /home/secops/.ssh/authorized_keys
chmod 600 /home/secops/.ssh/authorized_keys
chown -R secops:secops /home/secops/.ssh
sed -i 's/^#UseDNS.*/UseDNS no/' /etc/ssh/sshd_config
systemctl enable auditd
%end
